<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sound Wave Laboratory</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }

        /* TOMBOL KEMBALI (Sama seperti file air) */
        .btn-back {
            position: absolute; top: 20px; left: 20px;
            background: rgba(30, 30, 30, 0.8); color: #fff;
            border: 1px solid #444; padding: 10px 20px;
            border-radius: 30px; cursor: pointer; font-weight: bold;
            z-index: 100; transition: all 0.2s; display: flex;
            align-items: center; gap: 8px; font-family: inherit;
        }
        .btn-back:hover { background: #333; border-color: #00ff9d; color: #00ff9d; }

        .container {
            background-color: #1e1e1e; padding: 30px; border-radius: 15px;
            box-shadow: 0 0 50px rgba(0,0,0,0.8); width: 90%; max-width: 800px;
            text-align: center; border: 1px solid #333;
        }

        h1 { margin: 0 0 10px 0; color: #00ff9d; font-weight: 300; letter-spacing: 2px; }
        p { color: #888; margin-bottom: 30px; font-size: 0.9em; }

        canvas {
            background-color: #000; border: 2px solid #333; border-radius: 8px;
            width: 100%; height: 250px; margin-bottom: 30px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.9);
        }

        .controls-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; text-align: left; margin-bottom: 30px; }
        .control-box { background: #2a2a2a; padding: 20px; border-radius: 8px; border-left: 4px solid #00ff9d; }

        label { display: flex; justify-content: space-between; margin-bottom: 15px; font-weight: bold; font-size: 1.1em; }
        
        input[type=range] { width: 100%; height: 8px; background: #444; border-radius: 5px; outline: none; -webkit-appearance: none; cursor: pointer; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 24px; height: 24px; border-radius: 50%; background: #00ff9d; cursor: pointer; box-shadow: 0 0 10px rgba(0, 255, 157, 0.5); }

        .btn-main { background: transparent; color: #00ff9d; border: 2px solid #00ff9d; padding: 15px 50px; font-size: 20px; font-weight: bold; border-radius: 50px; cursor: pointer; transition: all 0.2s; font-family: monospace; }
        .btn-main:hover { background: #00ff9d; color: #000; box-shadow: 0 0 30px rgba(0, 255, 157, 0.4); }
        .btn-stop { background: #ff3366; border-color: #ff3366; color: white; }
        .btn-stop:hover { background: #ff0040; box-shadow: 0 0 30px rgba(255, 51, 102, 0.4); }

        .hint { display: block; margin-top: 10px; color: #666; font-size: 0.8em; }

        .wave-types { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .type-btn { background: #333; border: none; color: #888; padding: 5px 15px; border-radius: 4px; cursor: pointer; }
        .type-btn.active { background: #00ff9d; color: #000; }
    </style>
</head>
<body>

    <button class="btn-back" onclick="goBack()">⬅ Kembali</button>

    <div class="container">
        <h1>SOUND WAVE LAB</h1>
        <p>Demonstrasi Real-time Frekuensi & Amplitudo</p>
        <canvas id="audioCanvas"></canvas>

        <div class="wave-types">
            <button class="type-btn active" onclick="setWave('sine')">Sine (Halus)</button>
            <button class="type-btn" onclick="setWave('square')">Square (Kasar)</button>
            <button class="type-btn" onclick="setWave('sawtooth')">Sawtooth (Tajam)</button>
        </div>

        <div class="controls-grid">
            <div class="control-box">
                <label>Frekuensi (Pitch) <span id="freqVal">440 Hz</span></label>
                <input type="range" id="frequency" min="50" max="1000" value="440">
                <span class="hint">Geser Kiri (Bass) - Kanan (Treble)</span>
            </div>
            <div class="control-box">
                <label>Gain (Volume) <span id="gainVal">50%</span></label>
                <input type="range" id="volume" min="0" max="1" step="0.01" value="0.5">
                <span class="hint">Geser Kanan = Suara Lebih Keras</span>
            </div>
        </div>

        <button id="toggleBtn" class="btn-main" onclick="toggleSound()">START ENGINE ▶</button>
    </div>

    <script>
        function goBack() {
            if (window.history.length > 1) { window.history.back(); } 
            else { window.location.href = 'sound_system_workflow.html'; }
        }

        let audioCtx, oscillator, gainNode, analyser;
        let isPlaying = false;
        let animationId; 
        let waveType = 'sine';

        const canvas = document.getElementById("audioCanvas");
        const ctx = canvas.getContext("2d");
        const freqSlider = document.getElementById("frequency");
        const volSlider = document.getElementById("volume");
        const btn = document.getElementById("toggleBtn");
        
        function resize() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            if(!isPlaying) drawFlatLine();
        }
        
        function drawFlatLine() {
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.beginPath(); ctx.strokeStyle = "#333"; ctx.lineWidth = 2;
            ctx.moveTo(0, canvas.height/2); ctx.lineTo(canvas.width, canvas.height/2);
            ctx.stroke();
        }

        window.addEventListener('resize', resize);
        resize();

        function initAudio() {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioCtx.createAnalyser();
            analyser.fftSize = 2048;
        }

        function toggleSound() {
            if (isPlaying) {
                if(oscillator) { oscillator.stop(); oscillator.disconnect(); }
                isPlaying = false;
                btn.innerText = "START ENGINE ▶";
                btn.classList.remove("btn-stop");
                cancelAnimationFrame(animationId);
            } else {
                if (!audioCtx) initAudio();
                oscillator = audioCtx.createOscillator();
                gainNode = audioCtx.createGain();
                oscillator.type = waveType;
                oscillator.frequency.value = freqSlider.value;
                gainNode.gain.value = volSlider.value;
                oscillator.connect(gainNode);
                gainNode.connect(analyser);
                analyser.connect(audioCtx.destination);
                oscillator.start();
                isPlaying = true;
                btn.innerText = "STOP ENGINE ⏹";
                btn.classList.add("btn-stop");
                draw();
            }
        }

        function setWave(type) {
            waveType = type;
            if(oscillator && isPlaying) oscillator.type = type;
            document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }

        function draw() {
            animationId = requestAnimationFrame(draw);
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            analyser.getByteTimeDomainData(dataArray);

            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.lineWidth = 3; ctx.strokeStyle = "#00ff9d";
            ctx.shadowBlur = 15; ctx.shadowColor = "#00ff9d";
            ctx.beginPath();

            const sliceWidth = canvas.width * 1.0 / bufferLength;
            let x = 0;

            for (let i = 0; i < bufferLength; i++) {
                const v = dataArray[i] / 128.0;
                const y = v * canvas.height / 2;
                if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
                x += sliceWidth;
            }
            ctx.lineTo(canvas.width, canvas.height / 2);
            ctx.stroke();
            ctx.shadowBlur = 0; 
        }

        freqSlider.addEventListener("input", (e) => {
            document.getElementById("freqVal").innerText = e.target.value + " Hz";
            if (oscillator && isPlaying) oscillator.frequency.value = e.target.value;
        });
        
        volSlider.addEventListener("input", (e) => {
            let percent = Math.round(e.target.value * 100);
            document.getElementById("gainVal").innerText = percent + "%";
            if (gainNode && isPlaying) gainNode.gain.value = e.target.value;
        });
    </script>
</body>
</html>